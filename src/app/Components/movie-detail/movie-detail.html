<div class="container py-4">
  @if (loading) {
  <div class="row">
    <div class="col-12 text-center py-5">
      <div class="spinner-border text-warning" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>
  } @if (!loading && movie) {
  <div class="row">
    <div class="col-md-4 mb-4">
      <div class="position-relative">
        <img
          [src]="movie.poster_path"
          [alt]="movie.title"
          class="img-fluid rounded shadow"
          style="width: 100%; max-width: 400px"
        />
      </div>
    </div>

    <div class="col-md-8">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h1 class="display-6 fw-bold mb-2">{{ movie.title }}</h1>
          <p class="text-muted mb-3">{{ getYear(movie.release_date) }}</p>
        </div>

        <button
          class="btn btn-lg rounded-circle p-3 border-0 heart-btn"
          [class.btn-warning]="movie.isInWatchlist"
          [class.btn-outline-warning]="!movie.isInWatchlist"
          (click)="toggleWatchlist()"
          style="width: 60px; height: 60px"
        >
          <i
            class="fas fa-heart fa-lg"
            [class.text-white]="movie.isInWatchlist"
          ></i>
        </button>
      </div>

      <div class="mb-3">
        <div class="d-flex align-items-center">
          @for (star of getStars(); track $index) {
          <i
            class="fas fa-star me-1"
            [class.text-warning]="star.filled"
            [class.text-muted]="!star.filled"
          ></i>
          }
          <span class="ms-2 fw-bold">{{
            movie.vote_average | number : "1.1-1"
          }}</span>
        </div>
      </div>

      <p class="lead mb-4">{{ movie.overview }}</p>

      <div class="mb-4">
        @for (genre of movie.genres.slice(0, 3); track genre.id; let first =
        $first) {
        <button
          class="btn me-3 px-4"
          [class.btn-warning]="first"
          [class.btn-outline-secondary]="!first"
        >
          {{ genre.name }}
        </button>
        }
      </div>

      <div class="row mb-4">
        <div class="col-sm-6">
          <p class="mb-2">
            <strong>Duration:</strong> {{ formatRuntime(movie.runtime || 0) }}
          </p>
        </div>
        <div class="col-sm-6">
          <p class="mb-2">
            <strong>Language:</strong>
            {{ getLanguageName(movie.original_language) }}
          </p>
        </div>
      </div>

      @if (movie.production_companies && movie.production_companies.length > 0)
      {
      <div class="mt-4">
        <div class="bg-danger text-white px-3 py-2 d-inline-block rounded">
          <strong>{{
            movie.production_companies[0].name.toUpperCase()
          }}</strong>
        </div>
      </div>
      } @if (movie.homepage) {
      <div class="mt-3">
        <a
          [href]="movie.homepage"
          target="_blank"
          class="text-primary text-decoration-none"
        >
          <i class="fas fa-external-link-alt me-1"></i>Website
        </a>
      </div>
      }
    </div>
  </div>

  @if (recommendations.length > 0) {
  <div class="row mt-5">
    <div class="col-12">
      <h2 class="h3 fw-bold mb-4">Recommendations</h2>
    </div>
  </div>

  <div class="row g-4">
    @for (recMovie of recommendations; track recMovie.id) {
    <div class="col-6 col-md-4 col-lg-3 col-xl-2">
      <app-movie-card
        [movie]="recMovie"
        (watchlistToggle)="onWatchlistToggle($event)"
      >
      </app-movie-card>
    </div>
    }
  </div>
  } }
</div>
